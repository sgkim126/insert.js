"use strict"
!function(t,e){function n(){var t=[]
return localStorage||t.push("local storage"),fetch?C=e.fetch:XMLHttpRequest?C=i:t.push("XMLHttpRequest"),Promise||t.push("Promise"),t}function r(){var e=t.createElement("div")
return e.textContent="now loading...",e}function a(t,e,n){var r=JSON.parse(t.getItem(e))
return null===r?{status:g.NotIn}:n(r.date)?(t.removeItem(e),{data:r.data,status:g.Expired}):{data:r.data,status:g.Valid}}function o(t,e,n){var r=(new Date).getTime()
t.setItem(e,JSON.stringify({date:r,data:n}))}function i(t,e){return new Promise(function(n,r){var a=new XMLHttpRequest
a.onload=function(){n({text:function(){return new Promise(function(t){t(a.response)})},status:a.status})},a.onerror=function(t){r(t)},a.open(e.method,t,!0)
for(var o in e.headers)e.headers.hasOwnProperty(o)&&a.setRequestHeader(o,e.headers[o])
a.send(e.body)})}function u(t,n){var r=n+"src_"+t,i=e.localStorage,u=a(i,r,function(t){var e=100*Math.random(),n=(new Date).getTime()
return n>t+10*(60+e)*60*1e3}),c=u.data,s={"Content-type":"text/plain"},d="GET"
switch(u.status){case g.Valid:return Promise.resolve({data:c,from:H.Cache})
case g.NotIn:return C(t,{method:d,headers:s}).then(function(t){return t.text()}).then(function(t){return o(i,r,t),{data:t,from:H.Source}})
case g.Expired:return C(t,{method:d,headers:s}).then(function(t){return t.text()}).then(function(t){var e=t,n=e===c?H.Cache:H.Source
return o(i,r,e),{data:e,from:n}})}}function c(t){var e="html"
t.format||(t.format=e)
var n="insert"
return t.prefix||(t.prefix=n),t.prefix=t.prefix+"_",t}function s(t,e){e.innerHTML=t}function d(t,n,r){var i=r.prefix,u=r.src,c=i+"markdown_"+u,d=e.localStorage,f=a(d,c,function(e){return t.from===H.Source}).data
if(void 0!==f)return void s(f,n)
var h={"Content-type":"text/plain"},m="POST",v=t.data
C("https://api.github.com/markdown/raw",{method:m,body:v,headers:h}).then(function(t){var e=t.text(),n=t.status
return e.then(function(t){return{text:t,status:n}})}).then(function(t){var e=t.text
return 403===t.status?"Cannot convert markdown to html, because API rate limit exceeded":(o(d,c,e),e)})["catch"](function(t){return"Cannot convert markdown to html"}).then(function(t){return s(t,n)})}function f(t,e,n){switch(n.format){case"html":s(t.data,e)
break
case"markdown":d(t,e,n)
break
default:throw"No valid format."}}function h(t,e,r){var a=c(e),o=n()
if(0!==o.length){var i="Cannot insert contents because this browser does not support "+o.join(", ")
return void(t.textContent=i)}var s=u(a.src,a.prefix)
s.then(function(e){return r(e,t,a)}),s["catch"](function(e){t.innerText=e.toString()})}function m(t,e){h(t,e,function(t,e,n){s(t.data,e)})}function v(t,e){h(t,e,d)}function p(t,e){h(t,e,f)}function l(e,n){var a=t.currentScript,o=r()
a.parentNode.insertBefore(o,a),n(o,e)}function x(t){l(t,m)}function w(t){l(t,v)}function S(t){l(t,p)}var g,C=void 0
!function(t){t[t.NotIn=0]="NotIn",t[t.Valid=1]="Valid",t[t.Expired=2]="Expired"}(g||(g={}))
var H
!function(t){t[t.Cache=0]="Cache",t[t.Source=1]="Source"}(H||(H={}))
var k=t.currentScript,b=k.dataset
void 0!==b.src?S(b):(e.insert=p,e.insertHtml=m,e.insertMarkdown=v,e.insertHere=S,e.insertHtmlHere=x,e.insertMarkdownHere=w)}(document,window)
